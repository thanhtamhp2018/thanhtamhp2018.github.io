!function(){var e=function(e){var t={exports:{}};return e.call(t.exports,t,t.exports),t.exports},t=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};e(function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=window.Shopify,s={PAGE:".admin-bar__page",MODAL_ID:"share_theme_modal",MODAL_ACTIVATOR_BUTTON:"[data-modal-activator]",MODAL_DEACTIVATOR_BUTTON:"[data-modal-deactivator]",EXIT_PREVIEW_BUTTON:"[data-exit-preview-button]",PURCHASE_THEME_BUTTON:"[data-purchase-button]",CUSTOMIZE_THEME_BUTTON:"[data-customize-theme-button]",HIDE_BAR_BUTTON:"[data-hide-bar-button]"},n={PAGE_BACKDROP_IS_VISIBLE:"admin-bar__page--backdrop-is-visible"},r=function(){function e(t){var i=this;o(this,e),this.previewRootUrl=t,this.activatorButtons=Array.from(document.querySelectorAll(s.MODAL_ACTIVATOR_BUTTON)),this.activatorButtons.forEach(function(e){e.addEventListener("click",i.activateModal.bind(i))}),this.hideBarButtons=Array.from(document.querySelectorAll(s.HIDE_BAR_BUTTON)),this.hideBarButtons.forEach(function(e){e.addEventListener("click",i.hideIframe.bind(i))}),this.exitPreviewButtons=Array.from(document.querySelectorAll(s.EXIT_PREVIEW_BUTTON)),this.exitPreviewButtons.forEach(function(t){t.addEventListener("click",function(){e.redirectTo("/?preview_theme_id=")})}),this.purchaseThemeButtons=Array.from(document.querySelectorAll(s.PURCHASE_THEME_BUTTON)),this.purchaseThemeButtons.forEach(function(e){e.addEventListener("click",i.purchaseTheme.bind(i)),i.purchaseThemeUrl=e.getAttribute("data-theme-store-url")}),this.customizeThemeButtons=Array.from(document.querySelectorAll(s.CUSTOMIZE_THEME_BUTTON)),this.customizeThemeButtons.forEach(function(e){e.addEventListener("click",i.customizeTheme.bind(i)),i.customizeThemeUrl=e.getAttribute("data-customize-theme-url")}),this.deactivatorButton=document.querySelector(s.MODAL_DEACTIVATOR_BUTTON),this.deactivatorButton&&this.deactivatorButton.addEventListener("click",this.closeModal.bind(this)),this.page=document.querySelector(s.PAGE),this.target=window.parent,this.state={},this.$popover=$(this.page).find("."+a.UIPopover.CLASSES.BASE),this.$popover.on(a.UIPopover.EVENTS.ACTIVATING,this.activatePopover.bind(this)),this.$popover.on(a.UIPopover.EVENTS.DEACTIVATING,this.deactivatePopover.bind(this)),this.modalNode=document.getElementById(s.MODAL_ID),this.modalNode&&(this.modal=new a.UIModal(this.modalNode)),a.rootDispatcher.register(a.UIModal.EVENTS.AFTER_HIDE,this.deactivateModal.bind(this)),window.addEventListener("message",this.postMessageHandler.bind(this)),window.addEventListener("copy",this.copyShareableLinkHandler.bind(this))}return t(e,[{key:"setState",value:function(e){this.state=e,this.sendPostMessage(this.state.postMessageAction)}},{key:"activatePopover",value:function(){this.setState({postMessageAction:"open_popover"})}},{key:"deactivatePopover",value:function(){this.modal.isVisible()||this.setState({postMessageAction:"close_popover"})}},{key:"activateModal",value:function(){this.setState({postMessageAction:"open_modal"})}},{key:"deactivateModal",value:function(e){"share_theme_modal"===e.data.id&&this.setState({postMessageAction:"close_modal"})}},{key:"openModal",value:function(){this.page.classList.add(n.PAGE_BACKDROP_IS_VISIBLE),this.modal.show()}},{key:"closeModal",value:function(){this.modal.isVisible()&&this.modal.hide()}},{key:"sendPostMessage",value:function(e){this.target.postMessage(e,this.previewRootUrl)}},{key:"hideIframe",value:function(){this.sendPostMessage("hide_iframe")}},{key:"showBackdrop",value:function(){this.page.classList.add(n.PAGE_BACKDROP_IS_VISIBLE)}},{key:"hideBackdrop",value:function(){this.page.classList.remove(n.PAGE_BACKDROP_IS_VISIBLE)}},{key:"purchaseTheme",value:function(){this.setState({postMessageAction:"purchase_theme"})}},{key:"customizeTheme",value:function(){this.setState({postMessageAction:"customize_theme"})}},{key:"copyShareableLinkHandler",value:function(e){"share_theme_url"===e.target.id&&this.setState({postMessageAction:"copy_share_link"})}},{key:"postMessageHandler",value:function(t){switch(t.data){case"modal_opened":this.openModal();break;case"modal_closed":this.hideBackdrop();break;case"popover_opened":this.showBackdrop();break;case"popover_closed":this.hideBackdrop();break;case"redirected_to_purchase":e.redirectTo(this.purchaseThemeUrl);break;case"redirected_to_customize_theme":e.redirectTo(this.customizeThemeUrl)}}},{key:"tearDown",value:function(){this.$popover.off(a.UIPopover.EVENTS.ACTIVATING,this.activatePopover.bind(this)),this.$popover.off(a.UIPopover.EVENTS.DEACTIVATING,this.deactivatePopover.bind(this)),a.rootDispatcher.remove(a.UIModal.EVENTS.AFTER_HIDE,this.deactivateModal.bind(this)),window.removeEventListener("message",this.postMessageHandler.bind(this)),window.removeEventListener("copy",this.copyShareableLinkHandler.bind(this))}}],[{key:"redirectTo",value:function(e){window.parent.location.href=e}}]),e}();i["default"]=r,a.PreviewBar=null!=i["default"]?i["default"]:i})}("undefined"!=typeof global?global:"undefined"!=typeof window&&window);